= Kube 객체
:toc:
:toc-title:

== 계정(Account)
계정은 서비스 계정과 사용자 계정이 있다. 서비스 계정은 서비스 호출에서 인증을 위해 사용하고, 사용자 계정은 HyperCloud 콘솔에 로그인 인증을 위해 사용한다.

=== 서비스 계정 생성
서비스 계정은 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
서비스 계정의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/service-account-create.adoc["마스터 클러스터 콘솔 안내서"의 "서비스 계정 생성"]을 참고한다.

=== 사용자 계정 생성
사용자 계정은 HyperAuth를 통해서 생성이 가능하다. +
사용자 계정의 생성 방법에 대한 자세한 내용은  xref:hyperauth.adoc#HyperAuthUserAccountCreate["HyperAuth"의 "사용자 계정 생성"]을 참고한다.

== 롤(Role)
롤은 파드와 노드에 다양한 수준의 액세스 권한을 부여한다. 롤은 애플리케이션 워크로드 수준 또는 클러스터 수준의 액세스를 하도록 허용될 수 있다.

=== 롤 생성
롤은 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
롤의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/role-create.adoc["마스터 클러스터 콘솔 안내서"의 "롤 생성"]을 참고한다.

== 롤 바인딩(Rolebinding)
롤 바인딩은 계정과 롤을 연결해 주는 개체이다.

=== 롤 바인딩 생성
롤 바인딩은 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
롤 바인딩의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/role-binding-create.adoc["마스터 클러스터 콘솔 안내서"의 "롤 바인딩 생성"]을 참고한다.

== 컨피그 맵(ConfigMap)
컨피그 맵은 파드 생성 시에 다양한 형태로 활용할 수 있다. +
활용 방법으로 Tomcat을 예로 들면 Tomcat의 server.xml 파일을 컨피그 맵으로 등록할 경우 Tomcat의 이미지를 변경하지 않더라도 컨피그 맵을 통해 설정 변경이 간편해진다.

=== 컨피그 맵 생성
컨피그 맵은 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
컨피그 맵의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/config-map-create.adoc["마스터 클러스터 콘솔 안내서"의 "컨피그 맵 생성"]을 참고한다.

== 시크릿(Secret)
시크릿은 컨피그 맵과 유사하나 암호, 토큰 또는 키와 같은 중요한 데이터를 포함하는 개체이다. 

=== 시크릿 생성
시크릿은 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
시크릿의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/secret-create.adoc["마스터 클러스터 콘솔 안내서"의 "시크릿 생성"]을 참고한다.

== 디플로이먼트(Deployment)
파드는 기본적으로 Self-healing을 지원하지 않는다. 따라서 Self-healing과 Rolling Update 지원을 위해 디플로이먼트로 파드를 생성한다.

=== 디플로이먼트 생성
디플로이먼트는 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
디플로이먼트의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/deployment-create.adoc["마스터 클러스터 콘솔 안내서"의 "디플로이먼트 생성"]을 참고한다.

=== 컨피그 맵 및 시크릿 적용
컨테이너에 생성한 컨피그 맵 및 시크릿의 설정 정보를 적용한다.

. *디플로이먼트 생성* +
YAML 에디터를 사용한 디플로이먼트의 생성 또는 수정을 통해 아래와 같이 작성한다. 
+
.예시
[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tomcat-deploy
  namespace: default
spec:
  selector:
    matchLabels:
      app: tomcat
  replicas: 1
  template:
    metadata:
      labels:
        app: tomcat
    spec:
      containers:
        - name: tomcat
          image: 'xxx.xxx.xxx.xxx:5000/tomcat:8.5'
          ports:
            - containerPort: 8080
          env: <1>
            - name: PASSWORD <2>
              valueFrom:
                configMapKeyRef: <3>
                  name: configmap-test <4>
                  key: password <5>
... 생략 ...
----
+
<1> 환경 변수 적용을 위한 설정 항목
<2> 환경 변수의 이름
<3> 적용할 리소스의 종류
* configMapKeyRef : 컨피그 맵
* secretKeyRef : 시크릿
<4> 참조할 컨피그 맵(또는 시크릿)의 이름
<5> 컨피그 맵(또는 시크릿)에 작성한 값을 가져올 키(key)
. *적용 확인* +
파드의 터미널을 통해 환경 변수가 적용된 것을 확인한다.
+
image::../../images/figure_configmap_secret_apply.png[]
+
NOTE: 컨피그 맵 또는 시크릿의 설정 정보를 수정한 경우 파드를 재기동하면 수정된 내용이 자동으로 적용된다.

=== 볼륨 추가
디플로이먼트를 통해 파드를 생성한 이후 필요한 영구 볼륨 클레임(PVC) 및 마운트할 볼륨을 추가한다.

. *[스토리지 추가] 메뉴 실행* +
볼륨을 추가할 디플로이먼트의 *[스토리지 추가]* 메뉴를 실행한다.
+
image::../../images/figure_deployment_storage_add.png[]
+
<1> 마스터 클러스터 콘솔의 *[워크로드] > [디플로이먼트]* 메뉴 클릭
<2> 네임스페이스 선택
<3> image:../../images/figure_action_icon.png[](*[액션]*) 아이콘 클릭
<4> *[스토리지 추가]* 메뉴 선택

. *스토리지 정보 설정* +
*스토리지 추가* 화면에서 추가할 스토리지의 정보를 설정한다.
+
NOTE: 본 과정에서는 새로운 영구 볼륨 클레임을 생성하여 추가하는 방법에 대해서 기술한다.
+
image::../../images/figure_deployment_storage_add_02.png[]
+
각 설정 항목에 대한 설명은 다음과 같다. (* : 필수 설정 항목)
+
[width="100%",options="header", cols="1,3a"]
|====================
|항목|설명  
|퍼시스턴트 볼륨 클레임 *|영구 볼륨 클레임을 추가할 방식을 선택한다.

* 기존 클레임 사용 : 기존에 생성되어 있는 영구 볼륨 클레임을 선택하여 추가
* 새 클레임 생성 : 새로운 영구 볼륨 클레임을 생성하여 추가
|스토리지 클래스|영구 볼륨 클레임의 스토리지 클래스 이름을 선택한다. (단, "퍼시스턴트 볼륨 클레임"을 "새 클레임 생성"으로 선택한 경우에만 활성화)
|퍼시스턴트 볼륨 클레임 이름 *|영구 볼륨 클레임의 이름을 입력한다. (단, "퍼시스턴트 볼륨 클레임"을 "새 클레임 생성"으로 선택한 경우에만 활성화)
|접근 모드 *|마운트된 볼륨에 대한 접근 모드를 선택한다. (단, "퍼시스턴트 볼륨 클레임"을 "새 클레임 생성"으로 선택한 경우에만 활성화)

* 단일 사용자(RWO) : 하나의 노드에서 볼륨을 읽기, 쓰기로 마운트
* 공유 접속 (RWX) : 여러 노드에서 볼륨을 읽기, 쓰기로 마운트
* 읽기 전용(ROX) : 여러 노드에서 볼륨을 읽기 전용으로 마운트
|크기 *|스토리지의 용량을 입력한다. (단, "퍼시스턴트 볼륨 클레임"을 "새 클레임 생성"으로 선택한 경우에만 활성화)
|마운트 경로 *|컨테이너 내부 볼륨의 마운트 경로를 입력한다.
|하위 경로|컨테이너에 마운트될 볼륨 내의 선택적 경로를 입력한다. (기본값: 볼륨의 루트)
|컨테이너|볼륨을 탑재할 특정 컨테이너를 선택한다. (단, "특정 컴포넌트 선택"을 클릭한 경우에만 활성화)
|====================

. *설정 저장* +
설정이 완료되면 *[저장]* 버튼을 클릭해서 설정 내용을 저장한다.

=== 볼륨 제거
디플로이먼트에 추가된 볼륨을 제거한다.

. *디플로이먼트 상세 페이지 이동* +
삭제하려는 볼륨을 가지고 있는 디플로먼트의 상세 페이지로 이동한다.
+
image::../../images/figure_deployment_storage_del.png[]
<1> 마스터 클러스터 콘솔의 *[워크로드] > [디플로이먼트]* 메뉴 클릭
<2> 네임스페이스 선택
<3> 볼륨을 제거할 디플로이먼트의 이름 클릭

. *[볼륨 제거] 메뉴 실행* +
해당 디플로이먼트의 상세 페이지가 열리면 볼륨 목록에서 삭제할 볼륨의 *[볼륨 제거]* 메뉴를 실행한다.
+
image::../../images/figure_deployment_storage_del_02.png[]
<1> image:../../images/figure_action_icon.png[](*[액션]*) 아이콘 클릭
<2> *[볼륨 제거]* 메뉴 선택

== 영구 볼륨 클레임(PVC)
파드는 이미지 기반으로 생성된다. 따라서 실행 중에 생성되었던 파일들은 파드가 재생성될 경우에 사라지게 된다. 이를 막기 위해 스토리지 역할을 하는 영구 볼륨(Persistent Volume, PV)을 생성한 후 파드에서 마운트하여 여기에 파일이 생성되도록 한다. +
이때 영구 볼륨 클레임(Persistent Volume Claim, PVC)은 스토리지 클래스를 이용하여 동적으로 영구 볼륨을 생성하게 한다.

=== 영구 볼륨 클레임 생성
영구 볼륨 클레임은 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
영구 볼륨 클레임의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/persistent-volume-claim-create.adoc["마스터 클러스터 콘솔 안내서"의 "영구 볼륨 클레임 생성"]을 참고한다.

[NOTE]
====
영구 볼륨 클레임의 특징은 다음과 같다.

* 영구 볼륨 클레임을 생성하면 프로비저너를 통해 자동으로 영구 볼륨(PV)이 생성되고, 바운드(Bound)된다.
* NFS 스토리지의 경우 생성 이후 초기 할당된 용량보다 초과하여 사용이 가능하다. 
* 영구 볼륨 클레임을 삭제하면 기본적으로 영구 볼륨도 함께 삭제된다. 단, 설정을 통해 유지도 가능하다.
====

== HPA
파드는 서비스 요청량에 따라 CPU 사용률이 높아지거나, 메모리가 부족할 경우 서비스를 제공하지 못하는 경우가 발생할 수 있다. 이를 극복하기 위해 CPU 사용률이나 메모리 사용률에 따라 서비스 파드 수를 증가시키거나 감소시켜 개별 파드에 주어지는 부하를 분산시킨다.

=== HPA 생성
HPA는 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
HPA의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/hpa-create.adoc["마스터 클러스터 콘솔 안내서"의 "HPA 생성"]을 참고한다.


== 서비스(Service)
파드는 경우에 따라 재생성된다. 생성될 때마다 파드의 IP는 변동되는데 변경되는 IP로 영속적인 서비스 제공은 불가능하다. +
따라서 변경되지 않는 IP를 제공하기 위해 서비스 개체를 사용한다. 이때 제공 타입으로는 ClusterIP, NodePort, LoadBalancer가 있다.

* ClusterIP : 구성된 클라우드 클러스터 내에서만 사용 가능한 IP 제공
* NodePort : 클라우드 클러스터를 구성하고 있는 노드의 포트로 파드의  서비스를 연결한다. 이로써 노드의 IP와 포트를 이용하여 사용자가 원하는 서비스를 호출할 수 있다.
* LoadBalancer : 사용자가 사용 가능한 가상 IP를 할당하여 서비스를 제공한다.

=== 서비스 생성
서비스는 HyperCloud 콘솔의 마스터 클러스터 콘솔에서 생성이 가능하다. +
서비스의 생성 방법에 대한 자세한 내용은 xref:../../user_guide/resource_create_sub/service-create.adoc["마스터 클러스터 콘솔 안내서"의 "서비스 생성"]을 참고한다.

